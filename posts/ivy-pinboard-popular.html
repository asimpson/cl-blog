<p>Ok, this one is still piping hot in my <code>*scratch*</code> buffer so remember that before you criticize the rough edges. I&#39;ve long wanted to quickly filter through the <a href="https://pinboard.in/popular">popular links page</a> on <a href="https://pinboard.in">pinboard.in</a> without jumping over to a browser. Ideally this page would have an RSS feed or API end point but alas it has neither. I love <a href="https://github.com/asimpson/ivy-feedwrangler">pulling things into Emacs</a> (yay for text-based interfaces!); so I set out to pull these links into Emacs and display them via <a href="https://github.com/abo-abo/swiper">Ivy</a>.</p>
<p>Feel free to skip ahead and <a href="https://github.com/asimpson/ivy-pinboard-popular">checkout the repo</a> if you&#39;re so inclined.</p>
<h2 id="steps">Steps</h2>
<p>I <code>curl</code>ed the page down and pasted the HTML into a buffer in Emacs so I could start pulling things apart. My first attempt was to use the excellent <a href="https://github.com/AdamNiederer/elquery"><code>elquery</code> library</a> but that was choking on the DOM structure and I never could quite pin down where (sorry Adam, I need to post an issue about that!). My next attempt was to use a more &quot;manual&quot; scripting approach. Since Emacs possesses so many ways to manipulate buffer text I was sure there could be a programmatic way to do this (without doing a bunch of regexing which I&#39;m terrible at and even more so in Emacs). The basic series of steps boiled down to this:</p>
<ul>
<li>Use the new-to-me <code>keep-lines</code> function to trim everything out of the buffer <em>except</em> the popular links. I used the classname of the links (<code>bookmark_title</code>) to identify them.</li>
<li>Use <code>loop-for-each-line</code> to well loop over each line. Inside this loop I would need to pull out the <code>href</code> and the title of each anchor link.</li>
<li>I used <code>re-search-forward</code> to move from target to target to figure out the point boundaries for my href and my link text.</li>
</ul>
<p>I ended up breaking this functionality out into it&#39;s own function since I used it more than once and it was cumbersome to type it all out.</p>
<pre class="language-elisp">    (defun re-capture-between(re-start re-end)
      "Return the string between two regexes."
      (let (start end)
        (setq start (re-search-forward re-start))
        (setq end (re-search-forward re-end))
        (buffer-substring-no-properties start end)))

</pre>

<ul>
<li>The final step was dumping the <code>href</code> and the link text into a plist and <code>push</code> that into a larger collection I could pass onto <code>ivy-read</code> to generate my interface.</li>
</ul>
<h2 id="coding-string">Coding string</h2>
<p>One gotcha I ran into is that my titles would occasionally contain odd character sequences like <code>\302</code>. Turns out those are punctuation and various text symbols. The solution is to run the title through <code>decode-coding-string</code> for <code>&#39;utf-8</code> to generate the proper characters.</p>
<h2 id="-emacs">‚ù§ Emacs</h2>
<p>Emacs is so powerful for this type of text manipulation because you can interactively work each step of a program out in an actual buffer and then put those steps together into a function. Each potential solution I thought of was quickly trialed via <code>M:</code> and frequent looks at documentation. Hopefully this has been a helpful look into how I approach solving problems in Emacs. Thanks for reading!</p>
<p></div></p>
<p></pre></p>
